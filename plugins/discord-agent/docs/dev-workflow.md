# Discord Agent 快速开发工作流

## SpecStory → ClaudeCode 迭代 Loop

一个高效的 skill 开发和优化循环，利用真实对话数据驱动迭代。

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │  SpecStory  │───▶│  人工校准   │───▶│ ClaudeCode  │     │
│  │  记录对话   │    │  标注期望   │    │  分析优化   │     │
│  └─────────────┘    └─────────────┘    └──────┬──────┘     │
│         ▲                                      │            │
│         │                                      │            │
│         │         ┌─────────────┐              │            │
│         └─────────│  更新 Skill │◀─────────────┘            │
│                   │   迭代测试  │                           │
│                   └─────────────┘                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 步骤详解

### 1. SpecStory 记录对话

使用 [SpecStory](https://specstory.com) 自动记录与 Claude 的完整交互历史：

- 所有用户输入
- Claude 的完整回复
- 工具调用和结果
- 错误信息和异常

**为什么用 SpecStory？**

- 自动捕获，无需手动复制
- 保留完整上下文
- 方便回溯和分析

### 2. 人工校准

在记录的对话中标注：

- ✅ 正确的回复 - 符合预期
- ❌ 错误的回复 - 需要修正
- 💡 期望的回复 - 理想情况应该怎么回答
- ⚠️ 边界情况 - 需要特殊处理的场景

**校准重点：**

- Claude 是否正确理解了用户意图？
- 选择的 tool 是否合适？
- 回复的格式和内容是否符合预期？
- 有没有遗漏的功能或场景？

### 3. 打包给 ClaudeCode 分析

将整个对话历史提交给 ClaudeCode，要求分析：

```
请分析这段对话历史，识别：
1. 哪些 skill 的定义需要优化？
2. 是否需要新增 skill？
3. 现有 tool 的参数设计是否合理？
4. 有哪些边界情况没有覆盖？
```

### 4. Skill 迭代

根据 ClaudeCode 的分析结果：

- 更新 `skills/*/SKILL.md` 中的描述和示例
- 优化 `tools/*.py` 中的实现逻辑
- 补充缺失的功能
- 添加边界情况处理

## 最佳实践

### 高效记录

1. **场景覆盖**：确保对话覆盖主要使用场景
2. **边界测试**：故意触发一些边界情况
3. **错误恢复**：测试错误场景下的恢复能力

### 高质量校准

1. **及时标注**：对话结束后立即校准，记忆新鲜
2. **具体描述**：写清楚为什么这个回复不对，期望是什么
3. **优先级排序**：先修复影响大的问题

### 有效分析

1. **聚焦问题**：每次分析聚焦 1-2 个主题
2. **对比验证**：优化后重新测试同样的场景
3. **增量迭代**：小步快跑，频繁验证

## 示例

### 发现问题

```
用户: 帮我看看 Sisyphus Labs 最近在聊什么
Claude: [调用 discord_read] ... 返回了太多无关消息

校准: ❌ 应该先用 discord_list 找到正确的 channel，再 read
```

### 优化 Skill

更新 `discord-read/SKILL.md`：

```markdown
## 使用流程

1. 如果用户没有指定具体 channel，先用 discord_list 列出可用 channels
2. 根据用户意图选择最相关的 channel
3. 再调用 discord_read 获取消息
```

## 相关文件

- `skills/*/SKILL.md` - Skill 定义文件
- `tools/*.py` - Tool 实现代码
- `CLAUDE.md` - 项目整体说明
