# CLAUDE.md

Plugin guidance for Claude Code when working with Discord community data.

## Overview

This plugin provides skills for syncing and analyzing Discord messages. Messages are stored as Markdown files optimized for LLM comprehension.

## Available Skills

| Skill | Trigger Phrases |
|-------|-----------------|
| `discord-init` | "set up Discord", "configure Discord", "initialize Discord" |
| `discord-list` | "what servers do I have", "list channels in X" |
| `discord-sync` | "sync messages", "pull from Discord", "fetch history" |
| `discord-read` | "what's in #channel", "search Discord", "show messages" |
| `discord-send` | "send to Discord", "post in #channel", "reply to message" |
| `discord-chat-summary` | "summarize Discord", "what's been happening", "digest" |
| `discord-analyze` | "analyze Discord", "community health", "health report", "Discord metrics" |

## File Structure

**CRITICAL:** All file paths in this plugin are relative to the **current working directory** (cwd) where Claude Code is running - NOT the plugin directory. This allows the plugin to work from any directory.

```
your-project/                       # Current working directory (where you run Claude)
├── .env                           # Your credentials (Discord, Telegram, etc.)
├── config/
│   └── agents.yaml                # Unified config for all platforms
├── data/                          # Synced messages (auto-created)
│   ├── manifest.yaml              # Unified manifest for all platforms
│   └── discord/
│       ├── servers/
│       │   └── {server_id}-{slug}/...
│       └── dms/
│           └── {user_id}-{slug}/...
```

The plugin code lives elsewhere and is referenced via `--plugin-dir`.

## Data Locations

**All paths are relative to cwd (current working directory), NOT the plugin directory.**

**Storage Structure:** Uses unified v2 structure under `data/` with platform subdirectories.

### Server Data

**Manifest (index of all synced data):**
```
data/manifest.yaml
```

**Messages:**
```
data/discord/servers/{server_id}-{slug}/{channel_name}/messages.md
```

**Sync state:**
```
data/discord/servers/{server_id}-{slug}/sync_state.yaml
```

**Metadata:**
```
data/discord/servers/{server_id}-{slug}/server.yaml
data/discord/servers/{server_id}-{slug}/{channel_name}/channel.yaml
```

**Health Reports (generated by discord-analyze):**
```
data/discord/servers/{server_id}-{slug}/health-report.md    # Human-readable report
data/discord/servers/{server_id}-{slug}/health-report.yaml  # Structured data
```

### DM Data

**DM Manifest:**
```
data/discord/dms/manifest.yaml
```

**DM Messages:**
```
data/discord/dms/{user_id}-{username}/messages.md
```

**DM Metadata:**
```
data/discord/dms/{user_id}-{username}/user.yaml
data/discord/dms/{user_id}-{username}/sync_state.yaml
```

### Migration Note

Legacy data (from v1 structure in `data/{server_id}/` and `dms/discord/`) is automatically migrated to the unified structure on first sync.

## Message Format

Messages are stored in LLM-friendly Markdown:

```markdown
## 2026-01-03

### 10:30 AM - @alice (123456789)
Hello everyone!

### 10:31 AM - @bob (987654321)
↳ replying to @alice:
Hey Alice!

[attachment: file.png (245KB) https://...]

> [embed] **Title**
> Description text
> https://link

Reactions: heart 3 | rocket 5
```

## Workflow

1. User runs `discord-init` to configure server (or `discord-list` to browse)
2. User runs `discord-sync` to download messages
3. Read `messages.md` files directly or use `discord-read` tool
4. Use `discord-analyze` for comprehensive health reports with metrics
5. Use `discord-chat-summary` for AI-powered summaries
6. Use `discord-send` to respond when needed

## Health Analytics

The `discord-analyze` skill generates comprehensive community health reports:

```bash
# Basic analysis
/discord-analyze

# With specific time period
/discord-analyze --server 1196028153085296651 --days 30

# Sync and analyze in one step
/discord-sync --server 1196028153085296651 --analyze
```

Reports include:
- **Health Scores** (0-100): Activity, Engagement, Responsiveness, Diversity
- **Topic Clustering**: Automatic grouping of conversations by theme
- **Trend Detection**: Week-over-week changes with significance flags
- **Benchmark Comparison**: Healthy/Warning/Critical status per metric
- **Recommendations**: Prioritized actions based on analysis

## Prerequisites

User must have:
- `.env` with `DISCORD_USER_TOKEN` set
- Python 3.11+ installed

## Warning

Using a user token may violate Discord's Terms of Service. This is for personal archival and analysis only.
